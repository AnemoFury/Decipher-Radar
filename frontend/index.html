<!DOCTYPE html>
<html lang="en">

<head>
    <title>DECIPHER | Artificial Intelligence Fraud Detection</title>
    <meta name="description"
        content="Decipher is the world's most advanced AI-powered fraud detection platform. Protect your revenue with sub-second latency and trillion-dollar intelligence.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="DECIPHER | AI Fraud Detection">
    <meta property="og:description"
        content="Sub-second fraud protection trained on a trillion dollars in annual volume.">
    <meta property="og:type" content="website">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='100' height='100' rx='20' fill='black'/%3E%3Ccircle cx='30' cy='30' r='10' fill='%23f97316'/%3E%3Ccircle cx='55' cy='30' r='10' fill='%23f97316'/%3E%3Ccircle cx='80' cy='30' r='10' fill='%23f97316'/%3E%3Ccircle cx='30' cy='55' r='10' fill='%23f97316'/%3E%3Ccircle cx='55' cy='55' r='10' fill='%23f97316'/%3E%3Ccircle cx='80' cy='55' r='10' fill='%23f97316'/%3E%3Ccircle cx='30' cy='80' r='10' fill='%23f97316'/%3E%3Ccircle cx='55' cy='80' r='10' fill='%23f97316'/%3E%3Ccircle cx='80' cy='80' r='10' fill='%23f97316'/%3E%3C/svg%3E">

    <!-- Auth Guard: Middleware simulation -->
    <script>
        (function () {
            const userData = localStorage.getItem('decipher_user');
            if (!userData) {
                window.location.href = 'auth.html';
                return;
            }
            const user = JSON.parse(userData);
            if (!user.hasPlan) {
                window.location.href = 'waitlist.html';
            }
        })();
    </script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        black: '#000000',
                        zinc: {
                            800: '#27272a',
                            850: '#1f1f1f',
                            900: '#18181b',
                            950: '#09090b',
                        },
                        blue: {
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                        },
                        indigo: {
                            500: '#6366f1',
                            600: '#4f46e5',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fadeIn': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Base Styles */
        body {
            background-color: #f8fafc;
            color: #1e293b;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.02);
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
        }

        .glass-sidebar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid rgba(226, 232, 240, 0.6);
        }

        /* Neural Background Effect */
        #neural-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.4;
            pointer-events: none;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            body {
                overflow: auto;
            }

            .glass-sidebar {
                height: 100vh;
                position: fixed;
                z-index: 50;
            }
        }
    </style>
</head>

<body class="bg-slate-50 h-screen w-screen flex flex-col text-slate-800">

    <div id="root" class="h-full w-full flex flex-col relative z-10"></div>
    <canvas id="neural-canvas"></canvas>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Custom Hooks ---
        const useNetworkInfo = () => {
            const [info, setInfo] = useState({ ip: 'Scanning...', city: 'Unknown', isp: 'Unknown' });

            useEffect(() => {
                fetch('https://ipapi.co/json/')
                    .then(res => res.json())
                    .then(data => {
                        setInfo({
                            ip: data.ip,
                            city: `${data.city}, ${data.country_code}`,
                            isp: data.org,
                            lat: data.latitude,
                            lon: data.longitude
                        });
                    })
                    .catch(err => {
                        console.error("IP Fetch failed", err);
                        setInfo(prev => ({ ...prev, ip: '127.0.0.1 (Offline Mode)' }));
                    });
            }, []);
            return info;
        }

        const usePersistentState = (key, initialValue) => {
            const [state, setState] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    console.error("Error reading from localStorage", error);
                    return initialValue;
                }
            });
            useEffect(() => {
                window.localStorage.setItem(key, JSON.stringify(state));
            }, [key, state]);
            return [state, setState];
        };

        // --- Neural Network Visualizer Component ---
        const NeuralNetworkBackground = () => {
            const canvasRef = useRef(null);

            useEffect(() => {
                const canvas = document.getElementById('neural-canvas');
                const ctx = canvas.getContext('2d');
                let animationFrameId;

                const resizeCanvas = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                };

                window.addEventListener('resize', resizeCanvas);
                resizeCanvas();

                // Node setup
                const particles = [];
                const particleCount = 40; // Reduced for subtleties

                for (let i = 0; i < particleCount; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        vx: (Math.random() - 0.5) * 0.2,
                        vy: (Math.random() - 0.5) * 0.2,
                        size: Math.random() * 1.5 + 0.5
                    });
                }

                const render = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    // Update positions
                    particles.forEach(p => {
                        p.x += p.vx;
                        p.y += p.vy;

                        // Bounce
                        if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                        if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                        // Draw Particle
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                        ctx.fillStyle = '#cbd5e1'; // Slate-300
                        ctx.fill();
                    });

                    // Draw Connections
                    ctx.strokeStyle = 'rgba(203, 213, 225, 0.4)'; // Slate-300 with low opacity
                    ctx.lineWidth = 0.5;

                    for (let i = 0; i < particles.length; i++) {
                        for (let j = i + 1; j < particles.length; j++) {
                            const dx = particles[i].x - particles[j].x;
                            const dy = particles[i].y - particles[j].y;
                            const dist = Math.sqrt(dx * dx + dy * dy);

                            if (dist < 120) {
                                ctx.beginPath();
                                ctx.moveTo(particles[i].x, particles[i].y);
                                ctx.lineTo(particles[j].x, particles[j].y);
                                ctx.stroke();
                            }
                        }
                    }

                    animationFrameId = requestAnimationFrame(render);
                };

                render();

                return () => {
                    window.removeEventListener('resize', resizeCanvas);
                    cancelAnimationFrame(animationFrameId);
                };
            }, []);

            return null; // Canvas is outside React root
        };

        // --- Sub-Components ---
        const DashboardView = ({ transactions, getStatusBadge, logs, userNetwork }) => (
            <div className="space-y-6 md:space-y-8 animate-fadeIn pb-20 md:pb-0">
                {/* Dashboard Header Bar */}
                <div className="flex flex-col md:flex-row justify-between items-start md:items-center glass-panel p-6 rounded-2xl shadow-sm gap-4">
                    <div>
                        <h1 className="text-2xl md:text-3xl font-bold text-slate-800 tracking-tight leading-none">Security Operations Center</h1>
                        <p className="text-slate-500 text-[10px] font-mono uppercase tracking-widest mt-2 flex items-center gap-2">
                            <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                            Status: <span className="text-blue-600 font-bold">OPTIMAL</span>
                            <span className="text-slate-300 mx-1">|</span>
                            NODE: {userNetwork.ip}
                        </p>
                    </div>
                    <div className="flex gap-8 w-full md:w-auto">
                        <div className="text-right flex-1 md:flex-none">
                            <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Active Clusters</div>
                            <div className="text-xl md:text-2xl font-bold text-blue-600 font-mono">08/12</div>
                        </div>
                        <div className="text-right flex-1 md:flex-none">
                            <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Total Throughput</div>
                            <div className="text-xl md:text-2xl font-bold text-slate-800 font-mono">42.8M</div>
                        </div>
                    </div>
                </div>

                {/* Main Stats Cards */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                    <div className="glass-panel p-6 rounded-2xl relative overflow-hidden group hover:shadow-md transition-shadow">
                        <div className="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                        <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Fraud Blocked (24h)</div>
                        <div className="text-3xl font-bold text-slate-900">$1.24M</div>
                        <div className="text-[10px] text-emerald-600 mt-2 font-mono font-bold flex items-center gap-1">
                            <i data-lucide="trending-up" className="w-3 h-3"></i> 14.2% VS PREV
                        </div>
                    </div>
                    <div className="glass-panel p-6 rounded-2xl relative overflow-hidden group hover:shadow-md transition-shadow">
                        <div className="absolute top-0 left-0 w-1 h-full bg-slate-800"></div>
                        <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Model Accuracy</div>
                        <div className="text-3xl font-bold text-slate-900">99.98%</div>
                        <div className="text-[10px] text-slate-400 mt-2 font-mono uppercase font-bold">Stable v4.2.1-prod</div>
                    </div>
                    <div className="glass-panel p-6 rounded-2xl relative overflow-hidden group hover:shadow-md transition-shadow">
                        <div className="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                        <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Processing Time</div>
                        <div className="text-3xl font-bold text-slate-900">3.2ms</div>
                        <div className="text-[10px] text-blue-600 mt-2 font-mono font-bold">ULTRA-LOW LATENCY</div>
                    </div>
                </div>

                {/* Dashboard Main Grid */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
                    {/* Live Operations Table */}
                    <div className="glass-panel rounded-2xl overflow-hidden flex flex-col min-h-[400px] shadow-sm">
                        <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-white/40">
                            <h3 className="font-bold text-xs text-slate-800 uppercase tracking-widest flex items-center gap-2">
                                <i data-lucide="shield" className="w-3.5 h-3.5 text-blue-600"></i> Live Transactions
                            </h3>
                            <span className="flex items-center gap-1.5 text-[10px] text-blue-600 font-bold uppercase tracking-widest">
                                <span className="w-1.5 h-1.5 rounded-full bg-blue-600 animate-pulse"></span> Streaming
                            </span>
                        </div>
                        <div className="flex-1 overflow-x-auto">
                            <table className="w-full text-left text-xs whitespace-nowrap">
                                <thead className="text-slate-400 font-mono uppercase bg-slate-50/50 text-[10px]">
                                    <tr>
                                        <th className="px-5 py-3 font-bold">ID</th>
                                        <th className="px-5 py-3 font-bold">Amount</th>
                                        <th className="px-5 py-3 font-bold">Origin</th>
                                        <th className="px-5 py-3 font-bold">Risk Vector</th>
                                        <th className="px-5 py-3 font-bold text-right">Status</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {transactions.map(txn => (
                                        <tr key={txn.id} className="hover:bg-blue-50/30 transition-colors group">
                                            <td className="px-5 py-3 font-mono font-bold text-slate-500 group-hover:text-blue-600 transition-colors uppercase">{txn.id}</td>
                                            <td className="px-5 py-3 text-slate-900 font-bold">{txn.amount}</td>
                                            <td className="px-5 py-3 text-slate-500">
                                                <div className="font-medium text-slate-700">{txn.location}</div>
                                                <div className="text-[9px] font-mono opacity-60">{txn.ip}</div>
                                            </td>
                                            <td className="px-5 py-3">
                                                <div className="w-20 bg-slate-100 rounded-full h-1.5 mb-1 overflow-hidden">
                                                    <div
                                                        className={`h-full rounded-full transition-all duration-1000 ${txn.score < 50 ? 'bg-red-500' : 'bg-blue-500'}`}
                                                        style={{ width: `${txn.score}%` }}
                                                    ></div>
                                                </div>
                                                <span className="text-[9px] font-bold text-slate-400 uppercase tracking-widest">{txn.score}% SAFE</span>
                                            </td>
                                            <td className="px-5 py-3 text-right">
                                                {getStatusBadge(txn.status)}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* Live Decision Logs */}
                    <div className="glass-panel rounded-2xl overflow-hidden flex flex-col min-h-[400px] shadow-sm bg-slate-900 text-slate-200 border-none">
                        <div className="p-4 border-b border-slate-800 flex justify-between items-center bg-black/20">
                            <h3 className="font-bold text-xs text-slate-300 uppercase tracking-widest flex items-center gap-2">
                                <i data-lucide="terminal" className="w-3.5 h-3.5 text-blue-500"></i> Event Stream
                                <span className="ml-2 w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"></span>
                            </h3>
                            <span className="text-[10px] font-mono text-slate-500">tail -f /var/log/decipher/auth.log</span>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 space-y-2 font-mono text-[10px] md:text-[11px] custom-scrollbar">
                            {logs.map((log) => (
                                <div key={log.id} className="group border-l-2 border-transparent hover:border-blue-500 pl-3 py-1 transition-all opacity-80 hover:opacity-100">
                                    <div className="flex items-start gap-3">
                                        <span className="text-slate-500 whitespace-nowrap">[{log.timestamp}]</span>
                                        <span className={`font-bold uppercase tracking-widest text-[9px] px-1.5 rounded-sm ${log.type === 'error' ? 'text-red-400 bg-red-400/10' :
                                            log.type === 'success' ? 'text-blue-400 bg-blue-400/10' :
                                                'text-slate-400 bg-slate-800'
                                            }`}>{log.source}</span>
                                        <span className={`block break-all ${log.type === 'error' ? 'text-red-300' : 'text-slate-300'}`}>
                                            {log.message}
                                        </span>
                                    </div>
                                </div>
                            ))}
                            {logs.length === 0 && (
                                <div className="text-center text-slate-600 mt-12 italic uppercase tracking-[0.2em] text-[10px]">Initializing Neural Link...</div>
                            )}
                        </div>
                    </div>
                </div>
            </div>
        );

        // ... Other Views (UsersView, RulesEngineView, LiveEventsView, ThreatMapView, PlaceholderView) unchanged ...
        const UsersView = ({ users }) => {
            const handleAddEntity = () => {
                alert("Simulating Entity Addition Wizard...\n\nIn production, this opens a modal form to register a new user, merchant, or API node.");
            };

            const handleViewProfile = (name) => {
                alert(`Opening detailed profile for: ${name}\n\n- Transaction History\n- Device Graph\n- Risk Score Forecast`);
            };

            return (
                <div className="space-y-6 animate-fadeIn">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-xl font-bold text-slate-800 uppercase tracking-tight">Active Entities</h2>
                        <button onClick={handleAddEntity} className="btn-pill-blue px-4 py-2 text-xs hover:bg-blue-700 transition">Add New Entity</button>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {users.map(user => (
                            <div key={user.id} className="glass-panel p-5 rounded-xl border-l-4 border-blue-500">
                                <div className="flex justify-between items-start mb-4">
                                    <div className="flex items-center gap-3">
                                        <div className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-blue-600 border border-slate-200">
                                            {user.name.charAt(0)}
                                        </div>
                                        <div>
                                            <div className="text-sm font-bold text-slate-800">{user.name}</div>
                                            <div className="text-xs text-gray-500 font-mono">{user.email}</div>
                                        </div>
                                    </div>
                                    <div className={`text-xs font-bold ${user.riskScore < 30 ? 'text-blue-600' : 'text-yellow-600'}`}>
                                        Risk: {user.riskScore}
                                    </div>
                                </div>
                                <div className="space-y-2 mb-4">
                                    <div className="flex justify-between text-[10px] uppercase text-gray-500 font-mono">
                                        <span>Last Login</span>
                                        <span className="text-slate-700 font-bold">{user.lastSeen}</span>
                                    </div>
                                    <div className="flex justify-between text-[10px] uppercase text-gray-500 font-mono">
                                        <span>Device ID</span>
                                        <span className="text-slate-700 font-mono">dev_{Math.random().toString(36).substr(2, 6)}</span>
                                    </div>
                                </div>
                                <button onClick={() => handleViewProfile(user.name)} className="w-full py-2 bg-slate-50 hover:bg-slate-100 text-[10px] font-bold uppercase tracking-widest rounded transition text-slate-600 border border-slate-200">View Profile</button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // Placeholder for unchanged components to save space, but keeping them functional
        // Copying full implementation for consistency
        const RulesEngineView = () => {
            const [rules, setRules] = useState([
                { id: 1, name: 'Velocity Check (1h)', action: 'BLOCK', count: 124, perf: '99.9%', active: true },
                { id: 2, name: 'IP Geolocation Mismatch', action: 'REVIEW', count: 42, perf: '88.2%', active: true },
                { id: 3, name: 'Sudden High Volume', action: 'FLAG', count: 18, perf: '94.5%', active: true },
                { id: 4, name: 'Blacklisted Email Domain', action: 'BLOCK', count: 312, perf: '100%', active: true },
                { id: 5, name: 'Sequential Card Attempt', action: 'SMS_VERIFY', count: 8, perf: '92.1%', active: false },
            ]);

            const toggleRule = (id) => {
                setRules(rules.map(r => r.id === id ? { ...r, active: !r.active } : r));
            };

            const handleTest = () => alert("Running dry-run simulation on 10,000 recent transactions...");
            const handleDeploy = () => alert("Deploying rule set v2.4 to global edge nodes...");

            return (
                <div className="space-y-6 animate-fadeIn pb-20 md:pb-0">
                    <div className="flex justify-between items-center">
                        <h2 className="text-xl font-bold text-slate-800">Active Logic Rules</h2>
                        <div className="flex gap-2">
                            <button onClick={handleTest} className="px-3 py-1.5 bg-white border border-slate-200 hover:bg-slate-50 text-xs rounded-md text-slate-600 font-bold uppercase tracking-widest transition">Test Rule</button>
                            <button onClick={handleDeploy} className="px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-xs rounded-md text-white font-bold uppercase tracking-widest transition shadow-lg shadow-blue-500/20">+ Deploy</button>
                        </div>
                    </div>
                    <div className="glass-panel rounded-xl overflow-hidden mt-6">
                        <table className="w-full text-left text-xs">
                            <thead className="bg-slate-50 text-slate-500 uppercase font-mono border-b border-slate-100">
                                <tr>
                                    <th className="px-6 py-4">Rule Name</th>
                                    <th className="px-6 py-4">Action</th>
                                    <th className="px-6 py-4">Triggered (24h)</th>
                                    <th className="px-6 py-4">Performance</th>
                                    <th className="px-6 py-4">Status</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-100">
                                {rules.map((rule) => (
                                    <tr key={rule.id} className="hover:bg-slate-50 transition">
                                        <td className="px-6 py-4 font-bold text-slate-700">{rule.name}</td>
                                        <td className="px-6 py-4"><span className={`px-2 py-0.5 rounded text-[10px] font-mono ${rule.action === 'BLOCK' ? 'bg-red-100 text-red-600' : 'bg-blue-100 text-blue-600'}`}>{rule.action}</span></td>
                                        <td className="px-6 py-4 font-mono text-slate-500">{rule.count} hits</td>
                                        <td className="px-6 py-4 font-mono text-blue-600 font-bold">{rule.perf}</td>
                                        <td className="px-6 py-4">
                                            <button
                                                onClick={() => toggleRule(rule.id)}
                                                className={`w-8 h-4 rounded-full relative transition duration-300 ${rule.active ? 'bg-blue-600' : 'bg-slate-300'}`}
                                                aria-label="Toggle Rule"
                                            >
                                                <div className={`absolute top-1 w-2 h-2 rounded-full bg-white transition-all duration-300 ${rule.active ? 'left-5' : 'left-1'}`}></div>
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const LiveEventsView = ({ logs }) => (
            <div className="space-y-6 animate-fadeIn h-full flex flex-col pb-20 md:pb-0">
                <div className="flex justify-between items-center mb-4">
                    <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                        <i data-lucide="activity" className="w-5 h-5 text-blue-600"></i>
                        Live Decision Stream
                    </h2>
                    <div className="flex gap-2">
                        <button onClick={() => alert("Pod Health: 100%\nCPU: 12%\nMemory: 456MB")} className="px-3 py-1 bg-blue-50 text-blue-600 text-[10px] font-mono border border-blue-100 rounded-full animate-pulse hover:bg-blue-100 transition">● K8S_POD_ACTIVE</button>
                        <button onClick={() => alert("Java Runtime Environment\nVersion: 17.0.2\nGC: G1GC")} className="px-3 py-1 bg-slate-100 text-slate-500 text-[10px] font-mono border border-slate-200 rounded-full hover:bg-slate-200 transition">JVM_v17</button>
                    </div>
                </div>
                <div className="flex-1 glass-panel rounded-2xl overflow-hidden flex flex-col shadow-lg bg-slate-900 border-none">
                    <div className="bg-black/40 px-4 py-2 flex items-center gap-2">
                        <div className="flex gap-1.5">
                            <button className="w-2.5 h-2.5 rounded-full bg-red-500/80 hover:bg-red-500 transition" title="Close"></button>
                            <button className="w-2.5 h-2.5 rounded-full bg-yellow-500/80 hover:bg-yellow-500 transition" title="Minimize"></button>
                            <button className="w-2.5 h-2.5 rounded-full bg-green-500/80 hover:bg-green-500 transition" title="Maximize"></button>
                        </div>
                        <span className="text-[10px] font-mono text-slate-500 ml-2 italic">root@decipher-k8s-pod: /app/java -jar decipher-backend.jar</span>
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 space-y-3 font-mono text-xs custom-scrollbar">
                        {logs.map((log) => (
                            <div key={log.id} className="group border-l-2 border-transparent hover:border-blue-500 pl-4 py-1 transition-all opacity-90 hover:opacity-100">
                                <div className="flex items-start gap-4">
                                    <span className="text-slate-500 whitespace-nowrap">[{log.timestamp}]</span>
                                    <span className={`font-bold uppercase tracking-tighter text-[9px] w-24 px-1.5 py-0.5 rounded border ${log.type === 'error' ? 'text-red-400 border-red-500/20 bg-red-500/10' :
                                        log.type === 'success' ? 'text-blue-400 border-blue-500/20 bg-blue-500/10' : 'text-slate-400 border-slate-700 bg-slate-800'
                                        }`}>{log.source}</span>
                                    <span className={`flex-1 ${log.type === 'error' ? 'text-red-300' : 'text-slate-300'}`}>
                                        {log.message}
                                    </span>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        const ThreatMapView = () => (
            <div className="space-y-6 animate-fadeIn h-full flex flex-col pb-20 md:pb-0">
                <div className="flex justify-between items-center mb-4">
                    <h2 className="text-xl font-bold text-slate-800">Global Attack Surface</h2>
                    <div className="flex items-center gap-4 text-[10px] font-mono uppercase">
                        <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span> Critical Threats</span>
                        <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-yellow-500"></span> Potential Skimming</span>
                    </div>
                </div>
                <div className="flex-1 glass-panel rounded-2xl p-6 relative flex flex-col items-center justify-center border-dashed border-2 border-slate-200 group">
                    <div className="absolute inset-0 bg-gradient-to-br from-blue-50 to-transparent opacity-50 pointer-events-none"></div>
                    <button onClick={() => alert("Switching to 3D Globe Projection...")} className="relative z-10 transition-transform hover:scale-105 active:scale-95 focus:outline-none">
                        <i data-lucide="globe" className="w-32 h-32 text-slate-300 mb-6 transition duration-1000"></i>
                    </button>
                    <p className="text-slate-500 text-sm max-w-sm text-center mb-8 font-medium">Real-time geographic visualization is initializing WebGL context...</p>
                    <div className="w-full max-w-2xl space-y-2 relative z-10">
                        {[
                            { loc: 'Novosibirsk, RU', type: 'DDoS / HTTP Flood', risk: 'CRITICAL', time: '0.2s ago' },
                            { loc: 'Lagos, NG', type: 'Account Takeover Attempt', risk: 'HIGH', time: '1.4s ago' },
                            { loc: 'Shenzhen, CN', type: 'Brute Force / SSH', risk: 'MED', time: '2.8s ago' },
                        ].map((threat, i) => (
                            <div
                                key={i}
                                onClick={() => alert(`Investigating threat vector: ${threat.type}\nOrigin: ${threat.loc}\nRisk Level: ${threat.risk}`)}
                                className="flex justify-between items-center px-4 py-3 bg-white/50 rounded-lg border border-slate-200 hover:border-blue-300 transition shadow-sm cursor-pointer hover:bg-white"
                            >
                                <div className="flex items-center gap-4">
                                    <span className="font-mono text-red-600 text-[10px] font-bold">{threat.risk}</span>
                                    <div>
                                        <div className="text-xs font-bold text-slate-800">{threat.type}</div>
                                        <div className="text-[10px] text-slate-500">{threat.loc}</div>
                                    </div>
                                </div>
                                <span className="text-[10px] text-slate-400 font-mono">{threat.time}</span>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        const PlaceholderView = ({ title, onRequest }) => (
            <div className="flex-1 flex flex-col items-center justify-center min-h-[50vh] animate-fadeIn p-8">
                <div className="max-w-md w-full glass-panel rounded-2xl p-10 text-center border border-slate-100 relative overflow-hidden group shadow-lg">
                    <div className="absolute inset-0 bg-gradient-to-br from-blue-50 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition duration-500"></div>
                    <div className="w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition duration-300 relative z-10 border border-slate-200">
                        <i data-lucide="lock" className="w-8 h-8 text-slate-400"></i>
                    </div>
                    <h2 className="text-2xl font-bold text-slate-800 mb-2 relative z-10">{title}</h2>
                    <p className="text-slate-500 mb-8 relative z-10 text-sm">This module is part of the Enterprise plan.</p>
                    <button className="px-6 py-3 bg-slate-900 text-white font-bold rounded-lg hover:bg-slate-800 transition relative z-10 flex items-center justify-center gap-2 mx-auto w-full shadow-lg shadow-slate-900/20">
                        <span>Contact Sales</span>
                        <i data-lucide="arrow-right" className="w-4 h-4"></i>
                    </button>
                    <div className="mt-6 pt-6 border-t border-slate-100 text-xs text-slate-400 relative z-10 font-mono">
                        ID: #FEATURE_LOCKED
                    </div>
                </div>
            </div>
        );

        // --- Main App Component ---
        const App = () => {
            const [logs, setLogs] = useState([]); // Removed persistence to prevent stale data
            const [isSimulating, setIsSimulating] = useState(true);
            const userNetwork = useNetworkInfo();
            const [user, setUser] = useState(null);
            const [isProfileOpen, setIsProfileOpen] = useState(false);
            const [isNavOpen, setIsNavOpen] = useState(false);
            const [activeView, setActiveView] = useState('Dashboard'); // 'Dashboard', 'Live Events', etc.

            // "Real" Data State
            const [transactions, setTransactions] = useState([
                { id: 'TXN-8842', amount: '$1,240.00', ip: '203.44.12.9', location: 'Singapore', score: 98, status: 'approved', time: 'Just now' },
                { id: 'TXN-8841', amount: '$45.00', ip: '192.168.1.4', location: 'United States', score: 12, status: 'flagged', time: '2 mins ago' },
                { id: 'TXN-8840', amount: '$890.50', ip: '88.21.43.11', location: 'Germany', score: 92, status: 'approved', time: '5 mins ago' },
            ]);

            const [users] = useState([
                { id: 1, name: 'Alex Johnson', email: 'alex.j@fintech.io', riskScore: 12, lastSeen: '2 mins ago' },
                { id: 2, name: 'Sarah Chen', email: 's.chen@cloudbank.com', riskScore: 45, lastSeen: '14 mins ago' },
                { id: 3, name: 'Michael Ross', email: 'm.ross@legalcorp.net', riskScore: 8, lastSeen: '1 hour ago' },
                { id: 4, name: 'Elena Gomez', email: 'elena@startup.ai', riskScore: 82, lastSeen: 'Just now' },
            ]);

            useEffect(() => {
                const storedUser = localStorage.getItem('decipher_user');
                if (storedUser) {
                    try {
                        setUser(JSON.parse(storedUser));
                    } catch (e) {
                        console.error("Failed to parse user data", e);
                        setUser({ name: 'Admin User', email: 'admin@decipher.com', role: 'Administrator' });
                    }
                } else {
                    setUser({ name: 'Admin User', email: 'admin@decipher.com', role: 'Administrator' });
                }
            }, []);

            // Interaction Handlers
            const handleNavClick = (e, name) => {
                e.preventDefault();
                setActiveView(name);
                setIsNavOpen(false); // Close mobile nav
            };

            const handleSignOut = () => {
                localStorage.removeItem('decipher_user');
                window.location.href = 'auth.html';
            };

            const toggleSimulation = () => {
                setIsSimulating(!isSimulating);
            };

            // --- Synchronized Data Stream ---
            // This connects the transaction stream to the event log for realism
            useEffect(() => {
                if (!isSimulating) return;

                const runSimulation = () => {
                    const txId = Math.floor(Math.random() * 99999);
                    const amount = (Math.random() * 2000).toFixed(2);
                    const deviceId = `dev_${Math.random().toString(36).substr(2, 6)}`;
                    const ipAddress = `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
                    const locations = ['Singapore', 'United States', 'Germany', 'Japan', 'Brazil', 'France', 'China', 'United Kingdom', 'Canada', 'Australia'];
                    const randomLocation = locations[Math.floor(Math.random() * locations.length)];

                    // Probabilities
                    const isFraud = Math.random() > 0.85; // 15% chance of fraud
                    const isHighRisk = !isFraud && Math.random() > 0.7; // 25% chance of high risk but not fraud

                    const steps = [
                        { source: 'GATEWAY', msg: `Incoming transaction request #${txId}`, type: 'info' },
                        { source: 'ENRICH', msg: `Resolving device fingerprint ${deviceId}...`, type: 'info' },
                    ];

                    if (isFraud) {
                        steps.push({ source: 'ML_ENGINE', msg: `Anomalous velocity detected from IP ${ipAddress}`, type: 'warning' });
                        steps.push({ source: 'RULES', msg: `Geo-velocity mismatch: ${randomLocation} to last seen (2 mins ago)`, type: 'error' });
                        steps.push({ source: 'DECISION', msg: `BLOCKING transaction #${txId} (Score: 0.9${Math.floor(Math.random() * 9)})`, type: 'error' });
                    } else if (isHighRisk) {
                        steps.push({ source: 'ML_ENGINE', msg: `Elevated risk score observed (0.6${Math.floor(Math.random() * 9)})`, type: 'warning' });
                        steps.push({ source: 'RULES', msg: `Triggering 3DS verification challenge...`, type: 'warning' });
                        steps.push({ source: 'DECISION', msg: `CHALLENGE issued for transaction #${txId}`, type: 'warning' });
                    } else {
                        steps.push({ source: 'ML_ENGINE', msg: `Behavioral analysis normal (Score: 0.0${Math.floor(Math.random() * 9)})`, type: 'success' });
                        steps.push({ source: 'DECISION', msg: `APPROVING transaction #${txId}`, type: 'success' });
                    }

                    // Add logs sequentially
                    let stepDelay = 0;
                    steps.forEach(step => {
                        setTimeout(() => {
                            addLog(step.source, step.msg, step.type);
                        }, stepDelay);
                        stepDelay += Math.random() * 400 + 200; // Random delay
                    });

                    // Add transaction to table
                    setTimeout(() => {
                        let status = 'approved';
                        let score = Math.floor(Math.random() * 20) + 80; // Default high safety score

                        if (isFraud) {
                            status = 'flagged';
                            score = Math.floor(Math.random() * 30);
                        } else if (isHighRisk) {
                            status = 'review';
                            score = Math.floor(Math.random() * 30) + 40;
                        }

                        const newTxn = {
                            id: `TXN-${txId}`,
                            amount: `$${amount}`,
                            ip: ipAddress,
                            location: randomLocation,
                            score: score,
                            status: status,
                            time: 'Just now'
                        };
                        setTransactions(prev => [newTxn, ...prev].slice(0, 10));
                    }, stepDelay);
                };

                // Initial run
                runSimulation();

                // Periodic run
                const interval = setInterval(runSimulation, 3500); // New flow every 3.5 seconds

                return () => clearInterval(interval);
            }, [isSimulating]);

            const addLog = (source, message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString();
                setLogs(prev => [{ id: Date.now() + Math.random(), timestamp, source, message, type }, ...prev].slice(0, 50));
            };

            const getStatusBadge = (status) => {
                // Normalize status to lowercase for comparison
                const s = status.toLowerCase();
                if (s === 'approved') return <span className="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-emerald-100 text-emerald-600 border border-emerald-200 uppercase tracking-tighter">Approved</span>;
                if (s === 'flagged') return <span className="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-red-100 text-red-600 border border-red-200 uppercase tracking-tighter">High Risk</span>;
                if (s === 'review') return <span className="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-amber-100 text-amber-600 border border-amber-200 uppercase tracking-tighter">Review</span>;
                return <span className="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-slate-100 text-slate-500 border border-slate-200 uppercase tracking-tighter">{status}</span>;
            };

            // --- Render ---
            // Force dark theme on user dropdown to look good on light bg? No, adhere to light theme for glass panel.

            return (
                <div className="flex h-screen w-full bg-slate-50 text-slate-900 font-sans overflow-hidden selection:bg-blue-100 selection:text-blue-900 relative">
                    <NeuralNetworkBackground />

                    {/* Mobile Nav Toggle */}
                    <div className="md:hidden fixed top-0 left-0 w-full glass-nav z-50 px-4 py-3 flex justify-between items-center">
                        <div className="flex items-center gap-2 font-bold text-slate-900">
                            {/* minimalist 6-dot logo */}
                            <svg width="24" height="24" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="25" cy="25" r="10" fill="#2563eb" />
                                <circle cx="55" cy="25" r="10" fill="#2563eb" />
                                <circle cx="85" cy="25" r="10" fill="#2563eb" />
                                <circle cx="25" cy="55" r="10" fill="#2563eb" />
                                <circle cx="55" cy="55" r="10" fill="#2563eb" />
                                <circle cx="85" cy="55" r="10" fill="#2563eb" />
                            </svg>
                            DECIPHER
                        </div>
                        <button onClick={() => setIsNavOpen(!isNavOpen)} className="p-2 text-slate-600">
                            <i data-lucide={isNavOpen ? "x" : "menu"} className="w-6 h-6"></i>
                        </button>
                    </div>

                    {/* Sidebar */}
                    <aside className={`fixed md:relative inset-y-0 left-0 w-64 glass-sidebar border-r border-slate-200 flex flex-col z-40 transform transition-transform duration-300 md:translate-x-0 ${isNavOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                        {/* Logo Section */}
                        <div className="p-6 hidden md:flex items-center gap-3 border-b border-transparent">
                            <svg width="28" height="28" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="25" cy="25" r="10" fill="#2563eb" />
                                <circle cx="55" cy="25" r="10" fill="#2563eb" />
                                <circle cx="85" cy="25" r="10" fill="#2563eb" />
                                <circle cx="25" cy="55" r="10" fill="#2563eb" />
                                <circle cx="55" cy="55" r="10" fill="#2563eb" />
                                <circle cx="85" cy="55" r="10" fill="#2563eb" />
                            </svg>
                            <span className="text-lg font-black tracking-tight text-slate-900">DECIPHER</span>
                        </div>

                        {/* Navigation */}
                        <nav className="flex-1 px-4 py-6 space-y-1 mt-14 md:mt-0 overflow-y-auto">
                            <div className="px-3 mb-2 text-[10px] font-bold text-slate-400 uppercase tracking-widest">Platform</div>

                            <a href="#"
                                onClick={(e) => handleNavClick(e, 'Dashboard')}
                                className={`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${activeView === 'Dashboard' ? 'bg-blue-50 text-blue-600 shadow-sm ring-1 ring-blue-100' : 'text-slate-600 hover:bg-slate-100 hover:text-slate-900'}`}>
                                <i data-lucide="layout-dashboard" className="w-4 h-4"></i> Dashboard
                            </a>

                            <a href="#"
                                onClick={(e) => handleNavClick(e, 'Live Events')}
                                className={`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${activeView === 'Live Events' ? 'bg-blue-50 text-blue-600 shadow-sm ring-1 ring-blue-100' : 'text-slate-600 hover:bg-slate-100 hover:text-slate-900'}`}>
                                <i data-lucide="activity" className="w-4 h-4"></i> Live Events
                            </a>

                            <a href="#"
                                onClick={(e) => handleNavClick(e, 'Threat Map')}
                                className={`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${activeView === 'Threat Map' ? 'bg-blue-50 text-blue-600 shadow-sm ring-1 ring-blue-100' : 'text-slate-600 hover:bg-slate-100 hover:text-slate-900'}`}>
                                <i data-lucide="globe" className="w-4 h-4"></i> Threat Map
                            </a>

                            <div className="px-3 mt-8 mb-2 text-[10px] font-bold text-slate-400 uppercase tracking-widest">Management</div>

                            <a href="#"
                                onClick={(e) => handleNavClick(e, 'Users')}
                                className={`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${activeView === 'Users' ? 'bg-blue-50 text-blue-600 shadow-sm ring-1 ring-blue-100' : 'text-slate-600 hover:bg-slate-100 hover:text-slate-900'}`}>
                                <i data-lucide="users" className="w-4 h-4"></i> Users
                            </a>

                            <a href="#"
                                onClick={(e) => handleNavClick(e, 'Rules Engine')}
                                className={`flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${activeView === 'Rules Engine' ? 'bg-blue-50 text-blue-600 shadow-sm ring-1 ring-blue-100' : 'text-slate-600 hover:bg-slate-100 hover:text-slate-900'}`}>
                                <i data-lucide="shield-check" className="w-4 h-4"></i> Rules Engine
                            </a>

                            <div class="mt-auto pt-6 border-t border-slate-100">
                                <div class="px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg flex items-center gap-3">
                                    <div class="relative flex h-2 w-2">
                                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                        <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                                    </div>
                                    <div class="flex flex-col">
                                        <span class="text-[10px] font-bold text-slate-700 uppercase tracking-widest leading-none">Secure Session</span>
                                        <span class="text-[9px] text-slate-400 font-mono mt-0.5">TLS 1.3 | AES-256</span>
                                    </div>
                                </div>
                            </div>
                        </nav>

                        {/* User Profile */}
                        <div className="p-4 border-t border-slate-100">
                            <div className="flex items-center justify-between p-2 rounded-xl group cursor-pointer hover:bg-white/50 transition">
                                <div className="flex items-center gap-3">
                                    <div className="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-xs shadow-md shadow-blue-600/20">
                                        {user ? user.name.charAt(0) : 'A'}
                                    </div>
                                    <div className="hidden md:block">
                                        <div className="text-xs font-bold text-slate-800">{user ? user.name : 'Admin'}</div>
                                        <div className="text-[10px] text-slate-500 font-mono">Pro Plan</div>
                                    </div>
                                </div>
                                <button
                                    onClick={() => handleSignOut()}
                                    className="p-2 text-slate-400 hover:text-red-500 transition"
                                    title="Sign Out">
                                    <i data-lucide="log-out" className="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 relative z-0 h-full overflow-hidden flex flex-col pt-16 md:pt-0">
                        {/* Header Area */}
                        <header className="h-16 px-8 flex justify-between items-center z-10 hidden md:flex">
                            <div className="flex items-center gap-4 text-xs font-mono text-slate-400">
                                <span>/ platform / {activeView.toLowerCase().replace(' ', '-')}</span>
                            </div>

                            <div className="flex items-center gap-4">
                                <button className="p-2 text-slate-400 hover:text-slate-600 transition rounded-lg hover:bg-slate-100">
                                    <i data-lucide="bell" className="w-4 h-4"></i>
                                </button>
                                {/* Network Threat Level Indicator (USP Touch) */}
                                <div className="flex items-center gap-3 px-4 py-1.5 bg-slate-900 rounded-full border border-slate-800 shadow-sm">
                                    <div className="relative flex h-2.5 w-2.5">
                                        <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                        <span className="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
                                    </div>
                                    <span className="text-[10px] font-mono font-bold text-slate-300 uppercase tracking-widest">
                                        Network Secure
                                    </span>
                                </div>
                            </div>

                        </header>

                        {/* View Content */}
                        <div className="flex-1 overflow-y-auto p-4 md:p-8 custom-scrollbar">
                            {activeView === 'Dashboard' && <DashboardView transactions={transactions} getStatusBadge={getStatusBadge} logs={logs} userNetwork={userNetwork} />}
                            {activeView === 'Live Events' && <LiveEventsView logs={logs} />}
                            {activeView === 'Users' && <UsersView users={users} />}
                            {activeView === 'Rules Engine' && <RulesEngineView />}
                            {activeView === 'Threat Map' && <ThreatMapView />}
                        </div>
                    </main>
                </div >
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>