<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DECIPER | Console</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M55 30H30L20 45L30 60H55V30Z' fill='white'/%3E%3Crect x='65' y='10' width='20' height='80' rx='4' fill='white'/%3E%3C/svg%3E">
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        black: '#000000',
                        zinc: {
                            800: '#27272a',
                            850: '#1f1f1f',
                            900: '#18181b',
                            950: '#09090b',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            background-color: #000000;
            color: #e4e4e7;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            /* Prevent body scroll, handle in app */
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #09090b;
        }

        ::-webkit-scrollbar-thumb {
            background: #27272a;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3f3f46;
        }

        .glass-panel {
            background: rgba(24, 24, 27, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left: 2px solid white;
        }

        /* Canvas Background */
        #neural-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
            pointer-events: none;
        }
    </style>
</head>

<body class="bg-black h-screen w-screen flex flex-col">

    <div id="root" class="h-full w-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Custom Hooks ---
        const useNetworkInfo = () => {
            const [info, setInfo] = useState({ ip: 'Scanning...', city: 'Unknown', isp: 'Unknown' });

            useEffect(() => {
                fetch('https://ipapi.co/json/')
                    .then(res => res.json())
                    .then(data => {
                        setInfo({
                            ip: data.ip,
                            city: `${data.city}, ${data.country_code}`,
                            isp: data.org,
                            lat: data.latitude,
                            lon: data.longitude
                        });
                    })
                    .catch(err => {
                        console.error("IP Fetch failed", err);
                        setInfo(prev => ({ ...prev, ip: '127.0.0.1 (Offline Mode)' }));
                    });
            }, []);
            return info;
        }

        const usePersistentState = (key, initialValue) => {
            const [state, setState] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    console.error("Error reading from localStorage", error);
                    return initialValue;
                }
            });
            useEffect(() => {
                window.localStorage.setItem(key, JSON.stringify(state));
            }, [key, state]);
            return [state, setState];
        };

        // --- Neural Network Visualizer Component ---
        const NeuralNetworkBackground = ({ isSimulating }) => {
            const canvasRef = useRef(null);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let animationFrameId;

                const resizeCanvas = () => {
                    canvas.width = canvas.parentElement.clientWidth;
                    canvas.height = canvas.parentElement.clientHeight;
                };

                window.addEventListener('resize', resizeCanvas);
                resizeCanvas();

                // Node setup
                const particles = [];
                const particleCount = 60;

                for (let i = 0; i < particleCount; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: (Math.random() - 0.5) * 0.5,
                        size: Math.random() * 2 + 1
                    });
                }

                const render = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    // Update positions
                    particles.forEach(p => {
                        if (isSimulating) {
                            p.x += p.vx * 2; // Speed up when simulating
                            p.y += p.vy * 2;
                        } else {
                            p.x += p.vx;
                            p.y += p.vy;
                        }

                        // Bounce
                        if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                        if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                        // Draw Particle
                        ctx.beginPath();
                        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                        ctx.fillStyle = isSimulating ? '#ffffff' : '#52525b'; // White vs Zinc-600
                        ctx.fill();
                    });

                    // Draw Connections
                    ctx.strokeStyle = isSimulating ? 'rgba(255, 255, 255, 0.15)' : 'rgba(82, 82, 91, 0.1)';
                    ctx.lineWidth = 1;

                    for (let i = 0; i < particles.length; i++) {
                        for (let j = i + 1; j < particles.length; j++) {
                            const dx = particles[i].x - particles[j].x;
                            const dy = particles[i].y - particles[j].y;
                            const dist = Math.sqrt(dx * dx + dy * dy);

                            if (dist < 150) {
                                ctx.beginPath();
                                ctx.moveTo(particles[i].x, particles[i].y);
                                ctx.lineTo(particles[j].x, particles[j].y);
                                ctx.stroke();
                            }
                        }
                    }

                    animationFrameId = requestAnimationFrame(render);
                };

                render();

                return () => {
                    window.removeEventListener('resize', resizeCanvas);
                    cancelAnimationFrame(animationFrameId);
                };
            }, [isSimulating]);

            return <canvas ref={canvasRef} id="neural-canvas" />;
        };

        // --- Sub-Components ---
        const DashboardView = ({ transactions, getStatusBadge, logs }) => (
            <div className="space-y-6 animate-fadeIn">
                {/* Top Stats */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="glass-panel p-5 rounded-lg border-t-2 border-green-500">
                        <div className="text-xs font-mono text-gray-400 uppercase mb-2">Total Volume</div>
                        <div className="text-3xl font-bold text-white">$42.8M</div>
                        <div className="text-xs text-green-500 mt-1 font-mono">+12.5% this week</div>
                    </div>
                    <div className="glass-panel p-5 rounded-lg border-t-2 border-green-500">
                        <div className="text-xs font-mono text-gray-400 uppercase mb-2">Fraud Blocked</div>
                        <div className="text-3xl font-bold text-white">$1.2M</div>
                        <div className="text-xs text-green-500 mt-1 font-mono">2,402 attempts stopped</div>
                    </div>
                    <div className="glass-panel p-5 rounded-lg border-t-2 border-green-500">
                        <div className="text-xs font-mono text-gray-400 uppercase mb-2">Accuracy</div>
                        <div className="text-3xl font-bold text-white">99.98%</div>
                        <div className="text-xs text-gray-500 mt-1 font-mono">Model v4.2.1 Active</div>
                    </div>
                </div>

                {/* Main Content Grid */}
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    {/* Recent Transactions Table */}
                    <div className="lg:col-span-2 glass-panel rounded-lg overflow-hidden flex flex-col">
                        <div className="p-4 border-b border-white/10 flex justify-between items-center bg-zinc-950/50">
                            <h3 className="font-bold text-sm text-white">Live Transactions</h3>
                            <span className="text-xs text-green-500 font-mono animate-pulse">‚óè LIVE</span>
                        </div>
                        <div className="overflow-x-auto">
                            <table className="w-full text-left text-xs">
                                <thead className="text-gray-500 font-mono uppercase bg-white/5">
                                    <tr>
                                        <th className="px-4 py-3">ID</th>
                                        <th className="px-4 py-3">Amount</th>
                                        <th className="px-4 py-3">Location</th>
                                        <th className="px-4 py-3">Risk</th>
                                        <th className="px-4 py-3 text-right">Status</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-white/5">
                                    {transactions.map(txn => (
                                        <tr key={txn.id} className="hover:bg-white/5 transition-colors">
                                            <td className="px-4 py-3 font-mono text-gray-400">{txn.id}</td>
                                            <td className="px-4 py-3 text-white font-medium">{txn.amount}</td>
                                            <td className="px-4 py-3 text-gray-400">
                                                <div>{txn.location}</div>
                                                <div class="text-xs text-gray-600">
                                                    &copy; 2026 Deciper Security Inc.
                                                </div>
                                                <div className="text-[10px] text-gray-600 font-mono">{txn.ip}</div>
                                            </td>
                                            <td className="px-4 py-3">
                                                <div className="w-full bg-gray-800 rounded-full h-1.5 w-16 mb-1">
                                                    <div className={`h-1.5 rounded-full ${txn.score < 50 ? 'bg-red-500' : 'bg-green-500'}`} style={{ width: `${txn.score}%` }}></div>
                                                </div>
                                                <span className="text-[10px] text-gray-500">{txn.score}/100</span>
                                            </td>
                                            <td className="px-4 py-3 text-right">
                                                {getStatusBadge(txn.status)}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* Live Event Stream */}
                    <div className="glass-panel rounded-lg flex flex-col h-96 lg:h-auto">
                        <div className="p-4 border-b border-white/10 bg-zinc-950/50">
                            <h3 className="font-bold text-sm text-white flex items-center gap-2">
                                <i data-lucide="terminal-square" className="w-4 h-4 text-gray-400"></i> Decision Engine
                            </h3>
                        </div>
                        <div className="flex-1 overflow-y-auto p-2 space-y-1 font-mono text-xs custom-scrollbar">
                            {logs.map((log) => (
                                <div key={log.id} className="p-2 rounded hover:bg-white/5 border-l-2 border-transparent hover:border-white/20 transition-all animate-fadeIn">
                                    <div className="flex justify-between text-gray-500 mb-0.5">
                                        <span>{log.timestamp}</span>
                                        <span className="uppercase text-[10px]">{log.source}</span>
                                    </div>
                                    <div className={`${log.type === 'error' ? 'text-red-400' :
                                        log.type === 'success' ? 'text-green-400' :
                                            log.type === 'warning' ? 'text-yellow-400' : 'text-gray-300'
                                        }`}>
                                        {log.type === 'error' && 'ACTION: '}
                                        {log.message}
                                    </div>
                                </div>
                            ))}
                            {logs.length === 0 && (
                                <div className="text-center text-gray-600 mt-10 italic">Initializing stream...</div>
                            )}
                        </div>
                    </div>
                </div>
            </div>
        );

        const UsersView = ({ users }) => (
            <div className="space-y-6 animate-fadeIn">
                <div className="flex justify-between items-center mb-6">
                    <h2 className="text-xl font-bold text-white">Entity Management</h2>
                    <button className="btn-pill-emerald px-4 py-2 text-xs">Add New Entity</button>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {users.map(user => (
                        <div key={user.id} className="glass-panel p-5 rounded-xl border-l-4 border-green-500/50">
                            <div className="flex justify-between items-start mb-4">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center font-bold text-green-500">
                                        {user.name.charAt(0)}
                                    </div>
                                    <div>
                                        <div className="text-sm font-bold text-white">{user.name}</div>
                                        <div className="text-xs text-gray-500 font-mono">{user.email}</div>
                                    </div>
                                </div>
                                <div className={`text-xs font-bold ${user.riskScore < 30 ? 'text-green-500' : 'text-yellow-500'}`}>
                                    Score: {user.riskScore}
                                </div>
                            </div>
                            <div className="space-y-2 mb-4">
                                <div className="flex justify-between text-[10px] uppercase text-gray-600 font-mono">
                                    <span>Last Login</span>
                                    <span className="text-gray-400">{user.lastSeen}</span>
                                </div>
                                <div className="flex justify-between text-[10px] uppercase text-gray-600 font-mono">
                                    <span>Device ID</span>
                                    <span className="text-gray-400 font-mono">dev_{Math.random().toString(36).substr(2, 6)}</span>
                                </div>
                            </div>
                            <button className="w-full py-2 bg-white/5 hover:bg-white/10 text-[10px] font-bold uppercase tracking-widest rounded transition">View Profile Details</button>
                        </div>
                    ))}
                </div>
            </div>
        );

        const RulesEngineView = () => (
            <div className="space-y-6 animate-fadeIn">
                <div className="flex justify-between items-center">
                    <h2 className="text-xl font-bold text-white">Active Logic Rules</h2>
                    <div className="flex gap-2">
                        <button className="px-3 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-xs rounded-md text-gray-300">Test Rules</button>
                        <button className="px-3 py-1.5 bg-green-600 hover:bg-green-500 text-xs rounded-md text-white font-bold">+ New Rule</button>
                    </div>
                </div>
                <div className="glass-panel rounded-xl overflow-hidden">
                    <table className="w-full text-left text-xs">
                        <thead className="bg-white/5 text-gray-500 uppercase font-mono">
                            <tr>
                                <th className="px-6 py-4">Rule Name</th>
                                <th className="px-6 py-4">Action</th>
                                <th className="px-6 py-4">Triggered (24h)</th>
                                <th className="px-6 py-4">Performance</th>
                                <th className="px-6 py-4">Status</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-white/5">
                            {[
                                { name: 'Velocity Check (1h)', action: 'BLOCK', count: 124, perf: '99.9%', active: true },
                                { name: 'IP Geolocation Mismatch', action: 'REVIEW', count: 42, perf: '88.2%', active: true },
                                { name: 'Sudden High Volume', action: 'FLAG', count: 18, perf: '94.5%', active: true },
                                { name: 'Blacklisted Email Domain', action: 'BLOCK', count: 312, perf: '100%', active: true },
                                { name: 'Sequential Card Attempt', action: 'SMS_VERIFY', count: 8, perf: '92.1%', active: false },
                            ].map((rule, i) => (
                                <tr key={i} className="hover:bg-white/5 transition">
                                    <td className="px-6 py-4 font-bold text-white">{rule.name}</td>
                                    <td className="px-6 py-4"><span className={`px-2 py-0.5 rounded text-[10px] font-mono ${rule.action === 'BLOCK' ? 'bg-red-500/20 text-red-500' : 'bg-yellow-500/20 text-yellow-500'}`}>{rule.action}</span></td>
                                    <td className="px-6 py-4 font-mono text-gray-400">{rule.count} hits</td>
                                    <td className="px-6 py-4 font-mono text-green-500">{rule.perf}</td>
                                    <td className="px-6 py-4">
                                        <div className={`w-8 h-4 rounded-full relative transition ${rule.active ? 'bg-green-600' : 'bg-zinc-700'}`}>
                                            <div className={`absolute top-1 w-2 h-2 rounded-full bg-white transition-all ${rule.active ? 'left-5' : 'left-1'}`}></div>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        const ThreatMapView = () => (
            <div className="space-y-6 animate-fadeIn h-full flex flex-col">
                <div className="flex justify-between items-center mb-4">
                    <h2 className="text-xl font-bold text-white">Global Attack Surface</h2>
                    <div className="flex items-center gap-4 text-[10px] font-mono uppercase">
                        <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span> Critical Threats</span>
                        <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-yellow-500"></span> Potential Skimming</span>
                    </div>
                </div>
                <div className="flex-1 glass-panel rounded-2xl p-6 relative flex flex-col items-center justify-center border-dashed border-2 border-white/10 group">
                    <div className="absolute inset-0 bg-gradient-to-br from-red-500/5 to-transparent opacity-50"></div>
                    <i data-lucide="globe" className="w-32 h-32 text-zinc-800 mb-6 group-hover:scale-105 transition duration-1000"></i>
                    <p className="text-gray-500 text-sm max-w-sm text-center mb-8 font-medium">Real-time geographic visualization is currently processing background aggregate data. Below is the live threat vector log.</p>
                    <div className="w-full max-w-2xl space-y-2">
                        {[
                            { loc: 'Novosibirsk, RU', type: 'DDoS / HTTP Flood', risk: 'CRITICAL', time: '0.2s ago' },
                            { loc: 'Lagos, NG', type: 'Account Takeover Attempt', risk: 'HIGH', time: '1.4s ago' },
                            { loc: 'Shenzhen, CN', type: 'Brute Force / SSH', risk: 'MED', time: '2.8s ago' },
                        ].map((threat, i) => (
                            <div key={i} className="flex justify-between items-center px-4 py-3 bg-white/5 rounded-lg border border-white/5 hover:border-white/10 transition">
                                <div className="flex items-center gap-4">
                                    <span className="font-mono text-red-500 text-[10px] font-bold">{threat.risk}</span>
                                    <div>
                                        <div className="text-xs font-bold text-white">{threat.type}</div>
                                        <div className="text-[10px] text-gray-500">{threat.loc}</div>
                                    </div>
                                </div>
                                <span className="text-[10px] text-gray-600 font-mono">{threat.time}</span>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        const PlaceholderView = ({ title }) => (
            <div className="flex-1 flex flex-col items-center justify-center min-h-[50vh] animate-fadeIn p-8">
                <div className="max-w-md w-full glass-panel rounded-2xl p-10 text-center border border-white/10 relative overflow-hidden group">
                    <div className="absolute inset-0 bg-gradient-to-br from-green-500/5 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition duration-500"></div>
                    <div className="w-16 h-16 bg-zinc-800 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition duration-300 relative z-10">
                        <i data-lucide="lock" className="w-8 h-8 text-gray-400"></i>
                    </div>
                    <h2 className="text-2xl font-bold text-white mb-2 relative z-10">{title}</h2>
                    <p className="text-gray-400 mb-8 relative z-10">This module is currently in private beta or requires elevated permissions.</p>
                    <button className="px-6 py-3 bg-white text-black font-bold rounded-lg hover:bg-gray-200 transition relative z-10 flex items-center justify-center gap-2 mx-auto w-full">
                        <span>Request Access</span>
                        <i data-lucide="arrow-right" className="w-4 h-4"></i>
                    </button>
                    <div className="mt-6 pt-6 border-t border-white/5 text-xs text-gray-500 relative z-10">
                        Waitlist Position: <span className="text-green-500 font-mono">#4,821</span>
                    </div>
                </div>
            </div>
        );

        // --- Main App Component ---
        const App = () => {
            const [logs, setLogs] = usePersistentState('deciper_logs', []);
            const [isSimulating, setIsSimulating] = useState(true);
            const userNetwork = useNetworkInfo();
            const [user, setUser] = useState(null);
            const [isProfileOpen, setIsProfileOpen] = useState(false);
            const [activeView, setActiveView] = useState('Dashboard'); // 'Dashboard', 'Live Events', etc.

            // "Real" Data State
            const [transactions, setTransactions] = useState([
                { id: 'TXN-8842', amount: '$1,240.00', ip: '203.44.12.9', location: 'Singapore', score: 98, status: 'approved', time: 'Just now' },
                { id: 'TXN-8841', amount: '$45.00', ip: '192.168.1.4', location: 'United States', score: 12, status: 'flagged', time: '2 mins ago' },
                { id: 'TXN-8840', amount: '$890.50', ip: '88.21.43.11', location: 'Germany', score: 92, status: 'approved', time: '5 mins ago' },
                { id: 'TXN-8839', amount: '$12.00', ip: '54.22.10.3', location: 'Brazil', score: 45, status: 'review', time: '12 mins ago' },
            ]);

            const [users] = useState([
                { id: 1, name: 'Alex Johnson', email: 'alex.j@fintech.io', riskScore: 12, lastSeen: '2 mins ago' },
                { id: 2, name: 'Sarah Chen', email: 's.chen@cloudbank.com', riskScore: 45, lastSeen: '14 mins ago' },
                { id: 3, name: 'Michael Ross', email: 'm.ross@legalcorp.net', riskScore: 8, lastSeen: '1 hour ago' },
                { id: 4, name: 'Elena Gomez', email: 'elena@startup.ai', riskScore: 82, lastSeen: 'Just now' },
                { id: 5, name: 'David Smith', email: 'dsmith@merchant.com', riskScore: 22, lastSeen: '5 mins ago' },
                { id: 6, name: 'Jessica Lee', email: 'jlee@securepay.com', riskScore: 15, lastSeen: '10 mins ago' },
            ]);

            useEffect(() => {
                const storedUser = localStorage.getItem('deciper_user');
                if (!storedUser) {
                    window.location.href = 'auth.html';
                } else {
                    try {
                        setUser(JSON.parse(storedUser));
                    } catch (e) {
                        console.error("Failed to parse user data", e);
                        localStorage.removeItem('deciper_user');
                        window.location.href = 'auth.html';
                    }
                }
            }, []);

            // Interaction Handlers
            const handleNavClick = (e, name) => {
                e.preventDefault();
                setActiveView(name);
            };

            const handleAction = (action) => {
                addLog('User', `Triggered Action: ${action}`, 'success');
                // Removed alert for cleaner UX
            };

            useEffect(() => {
                lucide.createIcons();
            }, [logs, user, transactions, activeView]);

            // Realism: Auto-generate transactions
            useEffect(() => {
                if (!isSimulating) return;

                const interval = setInterval(() => {
                    const locations = ['United States', 'Germany', 'Japan', 'Brazil', 'France', 'China'];
                    const statuses = ['approved', 'approved', 'approved', 'flagged', 'review'];
                    const newTxn = {
                        id: `TXN-${Math.floor(Math.random() * 9000) + 1000}`,
                        amount: `$${(Math.random() * 2000).toFixed(2)}`,
                        ip: `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`,
                        location: locations[Math.floor(Math.random() * locations.length)],
                        score: Math.floor(Math.random() * 100),
                        status: statuses[Math.floor(Math.random() * statuses.length)],
                        time: 'Just now'
                    };

                    setTransactions(prev => [newTxn, ...prev].slice(0, 7)); // Keep last 7

                    if (newTxn.status === 'flagged') {
                        addLog('Fraud Engine', `High Risk transaction detected from ${newTxn.location} (${newTxn.ip})`, 'error');
                    }
                }, 3500);

                return () => clearInterval(interval);
            }, [isSimulating]);

            const addLog = (source, message, type = 'info') => {
                const timestamp = new Date().toLocaleTimeString();
                setLogs(prev => [{ id: Date.now(), timestamp, source, message, type }, ...prev].slice(0, 50));
            };

            const toggleSimulation = () => {
                setIsSimulating(!isSimulating);
            };

            const getScoreColor = (score) => {
                if (score > 80) return 'text-green-500'; // High score = Good/Safe
                if (score > 50) return 'text-yellow-500';
                return 'text-red-500';
            };

            const getStatusBadge = (status) => {
                switch (status) {
                    case 'approved': return <span className="inline-flex items-center px-2 py-0.5 rounded textxs font-medium bg-green-500/10 text-green-500">Approved</span>;
                    case 'flagged': return <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-500/10 text-red-500">High Risk</span>;
                    case 'review': return <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-500/10 text-yellow-500">Manual Review</span>;
                    default: return null;
                }
            };

            return (
                <div className="flex h-screen w-full bg-black text-white font-sans overflow-hiddenselection:bg-green-500 selection:text-black">

                    {/* Sidebar */}
                    <aside className="w-64 bg-zinc-950 border-r border-white/10 flex flex-col hidden md:flex z-20 transition-all">
                        {/* Logo Section */}
                        <div className="p-6 flex items-center gap-3 border-b border-white/10">
                            <svg width="24" height="24" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M60 20V80H80V20H60Z" fill="white" />
                                <path d="M20 50L60 20V45L40 60L20 50Z" fill="#10b981" />
                                <path d="M20 50V75L60 80V45L40 60L20 50Z" fill="#059669" />
                            </svg>
                            <span className="text-xl font-bold tracking-wider text-white">DECIPER</span>
                        </div>

                        <nav className="flex-1 py-6 px-3 space-y-1">
                            <div className="px-3 mb-2 text-xs font-mono text-gray-500 uppercase tracking-wider">Overview</div>
                            <a href="#" onClick={(e) => handleNavClick(e, 'Dashboard')} className={`flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md transition-all nav-item ${activeView === 'Dashboard' ? 'bg-green-500/10 text-green-500 border-l-2 border-green-500' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}>
                                <i data-lucide="layout-dashboard" className="w-4 h-4"></i> Dashboard
                            </a>
                            <a href="#" onClick={(e) => handleNavClick(e, 'Live Events')} className={`flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md transition-all nav-item ${activeView === 'Live Events' ? 'bg-green-500/10 text-green-500 border-l-2 border-green-500' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}>
                                <i data-lucide="activity" className="w-4 h-4"></i> Live Events
                            </a>
                            <a href="#" onClick={(e) => handleNavClick(e, 'Threat Map')} className={`flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md transition-all nav-item ${activeView === 'Threat Map' ? 'bg-green-500/10 text-green-500 border-l-2 border-green-500' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}>
                                <i data-lucide="map" className="w-4 h-4"></i> Threat Map
                            </a>

                            <div className="px-3 mt-8 mb-2 text-xs font-mono text-gray-500 uppercase tracking-wider">Analysis</div>
                            <a href="#" onClick={(e) => handleNavClick(e, 'Users')} className={`flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md transition-all nav-item ${activeView === 'Users' ? 'bg-green-500/10 text-green-500 border-l-2 border-green-500' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}>
                                <i data-lucide="users" className="w-4 h-4"></i> Users
                            </a>
                            <a href="#" onClick={(e) => handleNavClick(e, 'Rules Engine')} className={`flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md transition-all nav-item ${activeView === 'Rules Engine' ? 'bg-green-500/10 text-green-500 border-l-2 border-green-500' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}>
                                <i data-lucide="file-warning" className="w-4 h-4"></i> Rules Engine
                            </a>
                        </nav>

                        <div className="p-4 border-t border-white/10">
                            <div className="bg-zinc-900 rounded p-3 text-xs text-gray-400 border border-white/5">
                                <p className="font-bold text-white mb-1 flex items-center gap-2">
                                    <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                                    System Operational
                                </p>
                                <p className="font-mono text-[10px]">{userNetwork.ip}</p>
                            </div>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 flex flex-col relative bg-black">

                        {/* Header */}
                        <header className="h-16 border-b border-white/10 bg-zinc-950/80 backdrop-blur flex items-center justify-between px-6 z-20">
                            <div className="flex items-center gap-4">
                                <h1 className="text-sm font-medium text-gray-300">Platform <span className="text-gray-600">/</span> {activeView === 'Dashboard' ? 'Overview' : activeView}</h1>
                            </div>

                            <div className="flex items-center gap-4">
                                <div className="flex items-center gap-1 bg-white/5 rounded-full border border-white/5 p-1">
                                    <button onClick={() => setTheme('light')} className={`flex items-center justify-center w-7 h-7 rounded-full transition ${localStorage.getItem('theme') === 'light' ? 'bg-white/10 text-white' : 'text-gray-500'}`}>
                                        <i data-lucide="sun" className="w-3 h-3"></i>
                                    </button>
                                    <button onClick={() => setTheme('dark')} className={`flex items-center justify-center w-7 h-7 rounded-full transition ${localStorage.getItem('theme') === 'dark' || !localStorage.getItem('theme') ? 'bg-white/10 text-white' : 'text-gray-500'}`}>
                                        <i data-lucide="moon" className="w-3 h-3"></i>
                                    </button>
                                    <button onClick={() => setTheme('system')} className={`flex items-center justify-center w-7 h-7 rounded-full transition ${localStorage.getItem('theme') === 'system' ? 'bg-white/10 text-white' : 'text-gray-500'}`}>
                                        <i data-lucide="monitor" className="w-3 h-3"></i>
                                    </button>
                                </div>

                                <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-green-900/20 border border-green-500/20 text-xs font-medium text-green-400">
                                    <i data-lucide="shield-check" className="w-3 h-3"></i>
                                    PROTECTED
                                </div>

                                {/* User Profile */}
                                <div className="relative">
                                    <button onClick={() => setIsProfileOpen(!isProfileOpen)} className="flex items-center gap-3 focus:outline-none">
                                        <div className="text-right hidden md:block">
                                            <p className="text-xs font-bold text-white leading-none mb-1">{user?.name || 'Loading...'}</p>
                                        </div>
                                        {user?.avatar ? (
                                            <img src={user.avatar} className="w-8 h-8 rounded-full ring-1 ring-white/20 hover:ring-green-500 transition" alt="Profile" />
                                        ) : (
                                            <div className="w-8 h-8 bg-gray-700 rounded-full animate-pulse"></div>
                                        )}
                                    </button>

                                    {/* Dropdown */}
                                    {isProfileOpen && (
                                        <div className="absolute top-full right-0 mt-2 w-48 bg-zinc-900 border border-white/10 rounded-md shadow-xl py-1 z-50">
                                            <button onClick={() => handleAction('Settings')} className="block w-full text-left px-4 py-2 text-xs text-gray-300 hover:bg-white/5 hover:text-white transition">Settings</button>
                                            <button onClick={() => handleAction('API Keys')} className="block w-full text-left px-4 py-2 text-xs text-gray-300 hover:bg-white/5 hover:text-white transition">API Keys</button>
                                            <div className="border-t border-white/10 my-1"></div>
                                            <button
                                                onClick={() => { localStorage.removeItem('deciper_user'); window.location.reload(); }}
                                                className="block w-full text-left px-4 py-2 text-xs text-red-400 hover:bg-white/5 transition"
                                            >
                                                Sign Out
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </header>

                        {/* Dashboard Scrollable Area */}
                        <div className="flex-1 p-6 overflow-y-auto relative custom-scrollbar">
                            {/* Neural Network Background Visualization */}
                            <div className="absolute inset-0 z-0">
                                <NeuralNetworkBackground isSimulating={isSimulating} />
                            </div>

                            <div className="relative z-10 max-w-7xl mx-auto">
                                {activeView === 'Dashboard' && <DashboardView transactions={transactions} getStatusBadge={getStatusBadge} logs={logs} />}
                                {activeView === 'Users' && <UsersView users={users} />}
                                {activeView === 'Rules Engine' && <RulesEngineView />}
                                {activeView === 'Threat Map' && <ThreatMapView />}
                                {['Live Events', 'Platform'].includes(activeView) && <PlaceholderView title={activeView} />}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        // Global theme support for Console
        const applyTheme = (mode) => {
            if (mode === 'system') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.classList.toggle('light', !prefersDark);
            } else if (mode === 'light') {
                document.documentElement.classList.add('light');
            } else {
                document.documentElement.classList.remove('light');
            }
        };

        const setTheme = (mode) => {
            localStorage.setItem('theme', mode);
            applyTheme(mode);
            window.dispatchEvent(new Event('storage')); // Trigger re-render for icons
        };

        // Initial apply
        applyTheme(localStorage.getItem('theme') || 'dark');

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>